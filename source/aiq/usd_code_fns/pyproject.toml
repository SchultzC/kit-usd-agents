[tool.poetry]
name = "usd-code-aiq"
version = "0.3.0"
description = "USD Code functions for USD/OpenUSD development - providing USD code examples, documentation, and knowledge retrieval (NAT-compatible)"
authors = ["Nuttapong Chentanez <nchentanez@nvidia.com>"]
readme = "README.md"
homepage = "https://github.com/NVIDIA-Omniverse/kit-usd-agents"
repository = "https://github.com/NVIDIA-Omniverse/kit-usd-agents"
documentation = "https://github.com/NVIDIA-Omniverse/kit-usd-agents"
keywords = ["usd", "openusd", "ai", "tools", "code-generation"]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Topic :: Multimedia :: Graphics :: 3D Modeling",
    "License :: OSI Approved :: Apache Software License",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
]
packages = [{include = "omni_aiq_usd_code", from = "src"}]
include = [
    "src/omni_aiq_usd_code/data/**/*",
    "examples/config.yaml",
]

[tool.poetry.dependencies]
python = ">=3.11,<3.14"
# NAT dependencies - allow pre-releases
nvidia-nat = {version = ">=1.4.0rc3", allow-prereleases = true}
nvidia-nat-langchain = {version = ">=1.4.0rc3", allow-prereleases = true}
# LangChain dependencies
langchain = ">=1.2.6"
langchain-community = ">=0.3.31"
langchain-core = ">=0.3.80"
langchain-nvidia-ai-endpoints = ">=1.0.2"
# Vector search dependencies
faiss-cpu = ">=1.7.0"
requests = ">=2.25.0"
# Configuration support
pyyaml = ">=6.0"
# Telemetry support
redis = {extras = ["hiredis"], version = ">=4.5.0"}
# Transitive dependencies
grpcio = ">=1.76.0"

[tool.poetry.group.dev.dependencies]
pytest = "^7.0.0"
pytest-cov = "^4.0.0"
pytest-asyncio = "^0.21.0"
black = "^23.0.0"
flake8 = "^6.0.0"
mypy = "^1.0.0"

# Entry points for USD code functions - Dual registration for AIQ and NAT compatibility
# AIQ entry points (backwards compatibility)
[tool.poetry.plugins."aiq.components"]
omni_aiq_usd_code_search_usd_code_examples = "omni_aiq_usd_code.register_search_usd_code_examples"
omni_aiq_usd_code_search_usd_knowledge = "omni_aiq_usd_code.register_search_usd_knowledge"
omni_aiq_usd_code_list_usd_modules = "omni_aiq_usd_code.register_list_usd_modules"
omni_aiq_usd_code_list_usd_classes = "omni_aiq_usd_code.register_list_usd_classes"
omni_aiq_usd_code_get_usd_module_detail = "omni_aiq_usd_code.register_get_usd_module_detail"
omni_aiq_usd_code_get_usd_class_detail = "omni_aiq_usd_code.register_get_usd_class_detail"
omni_aiq_usd_code_get_usd_method_detail = "omni_aiq_usd_code.register_get_usd_method_detail"

# NAT entry points (native)
[tool.poetry.plugins."nat.components"]
omni_aiq_usd_code_search_usd_code_examples = "omni_aiq_usd_code.register_search_usd_code_examples"
omni_aiq_usd_code_search_usd_knowledge = "omni_aiq_usd_code.register_search_usd_knowledge"
omni_aiq_usd_code_list_usd_modules = "omni_aiq_usd_code.register_list_usd_modules"
omni_aiq_usd_code_list_usd_classes = "omni_aiq_usd_code.register_list_usd_classes"
omni_aiq_usd_code_get_usd_module_detail = "omni_aiq_usd_code.register_get_usd_module_detail"
omni_aiq_usd_code_get_usd_class_detail = "omni_aiq_usd_code.register_get_usd_class_detail"
omni_aiq_usd_code_get_usd_method_detail = "omni_aiq_usd_code.register_get_usd_method_detail"

[tool.poetry.scripts]
usd-code-aiq = "omni_aiq_usd_code.__main__:main"

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"

[tool.black]
line-length = 120
target-version = ["py311"]
include = '\.pyi?$'

[tool.flake8]
max-line-length = 120
ignore = ["E501", "W503"]

[tool.mypy]
python_version = "3.11"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
addopts = "-v --cov=omni_aiq_usd_code --cov-report=term-missing"